{% extends "base.njk" %}
{% block title %}All Shows{% endblock %}
{% block content %}
<div class="table-wrapper">
   <div id="letter-bar" class="letter-bar"></div>
<div id="band-pills" class="d-flex flex-wrap gap-2 justify-content-center my-2" style="display:none;"></div>

  <!-- Pills will be injected here -->
</div>
<p id="show-count" class="show-counter">
  ðŸŽ« Shows: <span id="show-count-number">{{ publicShows | length }}</span>
</p>
   <table id="shows-table">
      <thead>
         <tr>
            <th>Artist</th>
            <th>Date</th>
            <th>Location</th>
            <th>Venue</th>
            <th>Length</th>
            <th>Size</th>
            <th>Format</th>
            <th>Type</th>
            <th>Source</th>
            <th>Taper(s)</th>
            <th>Images</th>
            <th>Page</th>
         </tr>
      </thead>
      <tbody>
         {% set currentGroup = null %}
         {% for show in shows | sort(attribute='startDateUnix') %}
         {% if show.public %}
         {% set groupKey = show.bands[0] %}
         {% if groupKey != currentGroup %}
         {% set currentGroup = groupKey %}
         <tr class="band-label-row" data-label="true">
            <td colspan="12" class="band-label">ðŸŽ¸ {{ groupKey }}</td>
         </tr>
         {% endif %}
         <tr class="paginated-show" data-band="{{ show.bands[0] }}" data-json="{{ show | dump | urlencode }}">
            <td>
               {% if show.bands %}
               {{ show.bands | join(", ") }}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td>
               {% if show.startDateUnix %}
               {{ show.startDateUnix | date("yyyy-MM-dd") }}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td>
               {% if show.location %}
               {{ show.location.city or "" }}{% if show.location.state %}, {{ show.location.state }}{% endif %}, {{ show.location.country or "" }}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td>
               {{ show.location.venue or "â€”" }}
            </td>
            <td>
               {% if show.specs and show.specs.length %}
               {{ show.specs.length | formatTime }}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td>
               {% if show.specs and show.specs.media and show.specs.media.length %}
               {% set media = show.specs.media %}
               <div class="media-wrapper">
                  {% set main = media[0] %}
                  <span>{{ main.size | smartSize }}{{ main.unit }}</span>
                  {% if media.length > 1 %}
                  <a href="#" class="toggle-media" data-target="media-{{ loop.index0 }}">
                  â–¾ +{{ media.length - 1 }}
                  </a>
                  {% endif %}
               </div>
               {% if media.length > 1 %}
               <div id="media-{{ loop.index0 }}" class="extra-media">
                  {% for medium in media.slice(1) %}
                  <div>{{ medium.size | smartSize }}{{ medium.unit }}</div>
                  {% endfor %}
               </div>
               {% endif %}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td>
               {% if show.specs and show.specs.sourceDetail %}
               {{ show.specs.sourceDetail.fileFormat or "â€”" }}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td class="type-cell">
               {% if show.specs and show.specs.sourceDetail %}
               {{ show.specs.sourceDetail.recordingType or "â€”" }}
               {% if show.category == "audio" %}
               <span class="type-label audio-label">audio</span>
               {% elif "misc" in show.category %}
               <span class="type-label misc-label">misc</span>
               {% elif "video" in show.category %}
               <span class="type-label video-label">video</span>
               {% endif %}
               {% else %}
               â€”
               {% endif %}
            </td>
            <td class="type-cell">
               {{ show.source or "â€”" }}
               {% if show.fileSlug and 'show_1' in show.fileSlug %}
               <span class="show-label">Show 1</span>
               {% elif show.fileSlug and 'show_2' in show.fileSlug %}
               <span class="show-label">Show 2</span>
               {% endif %}
               {% if show.master == true or (show.tapers and show.tapers.length == 1 and show.tapers[0] == "Vortex") %}
               <span class="trade-label master">MASTER</span>
               {% endif %}
            </td>
            <td class="type-cell">
               {% if show.tapers and show.tapers.length %}
               {% set tapers = show.tapers %}
               <div class="media-wrapper">
                  <span>{{ tapers[0] }}</span>
                  {% if tapers.length > 1 %}
                  <a href="#" class="toggle-media" data-target="media-{{ loop.index0 }}">
                  â–¾ +{{ tapers.length - 1 }}
                  </a>
                  {% endif %}
               </div>
               {% if tapers.length > 1 %}
               <div id="media-{{ loop.index0 }}" class="extra-media">
                  {% for taper in tapers.slice(1) %}
                  <div>{{ taper }}</div>
                  {% endfor %}
               </div>
               {% endif %}
               {% else %}
               â€”
               {% endif %}
            
               {% if show.tradeLabel == 'RT' %}
                 <span class="trade-label red">RT</span>
               {% elif show.tradeLabel == 'NT' %}
                 <span class="trade-label blue">NT</span>
               {% endif %}
            </td>
            <td>
              {% if show.images and show.images.length %}
                {% set firstImg = show.images[0] %}
                <span
                  role="button"
                  title="View images"
                  style="cursor: pointer; font-size: 18px;"
                  onclick='openModal("{{ firstImg.externalId }}", {{ show.images | dump | safe }})'
                >ðŸ“¸</span>
              {% else %}
                â€”
              {% endif %}
            </td>
            <td>
               <a href="{{ show.permalink | url }}" title="View info" style="font-size: 1.20em;">ðŸŽ«</a>
            </td>
         </tr>
         {% endif %}
         {% endfor %}
         <script src="{{ '/scripts/shows-filter.js' | url }}"></script>
      </tbody>
   </table>
   <div id="pagination-controls" class="my-3"></div>
   <script src="{{ '/scripts/hammer.min.js' | url }}"></script>
   <!-- Modal for image preview -->
   <div id="imageModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000; align-items:center; justify-content:center;">
      <div class="modal-inner">
         <img id="modalClose" class="close-btn" src="{{ '/assets/images/icon_close.png' | url }}" alt="Close" onclick="closeModal()" />
         <img id="modalPrev" class="nav-arrow" src="{{ '/assets/images/icon_prev.png' | url }}" alt="Previous" onclick="prevImage()" />
         <img id="modalNext" class="nav-arrow" src="{{ '/assets/images/icon_next.png' | url }}" alt="Next" onclick="nextImage()" />
         <!-- Image frame -->
         <img id="modalImage" style="width:100%; height:100%; border:none; border-radius:0px;"></img>
         <!-- Swipe overlay -->
         <div id="gestureOverlay" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:10;"></div>
         <div id="imageCounter" style="position: absolute; top: 14px; left: 20px; font-size: 13px; background-color: rgba(0, 0, 0, 0.5); color: #fff; padding: 3px 8px; border-radius: 6px; z-index: 30; font-family: sans-serif;"></div>
      </div>
   </div>
   <script src="{{ '/scripts/shows-table.js' | url }}"></script>
   <script src="{{ '/scripts/image-modal-viewer.js' | url }}"></script>
</div>
{% endblock %}